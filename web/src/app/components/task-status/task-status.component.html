<div class="task-status-container">
  @if (loading) {
    <div class="loading">
      <mat-spinner diameter="30"></mat-spinner>
      <p>Loading task...</p>
    </div>
  }

  @if (error) {
    <mat-card class="error">
      <mat-card-content>
        <div style="display: flex; align-items: center; gap: 8px;">
          <mat-icon color="warn">error</mat-icon>
          <span>{{ error }}</span>
        </div>
      </mat-card-content>
    </mat-card>
  }

  @if (!loading && !error && asyncTask) {
    <mat-card class="task-details" [ngClass]="getStatusClass()">
      <mat-card-header class="task-header">
        <mat-card-title>
          <div style="display: flex; align-items: center; gap: 8px;">
            <mat-icon [ngClass]="getStatusIcon()">{{ getStatusIconName() }}</mat-icon>
            Task: {{ asyncTask.type | titlecase }}
          </div>
        </mat-card-title>
        <mat-card-subtitle>ID: {{ asyncTask.id }}</mat-card-subtitle>
      </mat-card-header>
      <mat-card-content class="task-info">
        <mat-list>
          <mat-list-item>
            <span matListItemTitle>Status</span>
            <span matListItemLine>
              <mat-chip class="status-chip" [ngClass]="getStatusClass()">{{ asyncTask.status | titlecase }}</mat-chip>
            </span>
          </mat-list-item>
          <mat-list-item>
            <span matListItemTitle>Message</span>
            <span matListItemLine>{{ asyncTask.message || 'No message' }}</span>
          </mat-list-item>
          @if (asyncTask.progress && asyncTask.progress > 0) {
            <mat-list-item>
              <span matListItemTitle>Progress</span>
              <div matListItemLine class="progress-container">
                <mat-progress-bar mode="determinate" [value]="asyncTask.progress"></mat-progress-bar>
                <span class="progress-text">{{ asyncTask.progress }}%</span>
              </div>
            </mat-list-item>
          }
          <mat-list-item>
            <span matListItemTitle>Created</span>
            <span matListItemLine>{{ formatDate(asyncTask.created_at) }}</span>
          </mat-list-item>
          @if (asyncTask.started_at) {
            <mat-list-item>
              <span matListItemTitle>Started</span>
              <span matListItemLine>{{ formatDate(asyncTask.started_at) }}</span>
            </mat-list-item>
          }
          @if (asyncTask.completed_at) {
            <mat-list-item>
              <span matListItemTitle>Completed</span>
              <span matListItemLine>{{ formatDate(asyncTask.completed_at) }}</span>
            </mat-list-item>
          }
          @if (asyncTask.started_at) {
            <mat-list-item>
              <span matListItemTitle>Duration</span>
              <span matListItemLine>{{ getElapsedTime() }}</span>
            </mat-list-item>
          }
        </mat-list>
      </mat-card-content>
      <mat-card-actions class="task-actions">
        @if (!autoRefresh) {
          <button mat-button color="primary" (click)="loadTask()">
            <mat-icon>refresh</mat-icon>
            Refresh
          </button>
        }
      </mat-card-actions>
    </mat-card>
  }
</div>
